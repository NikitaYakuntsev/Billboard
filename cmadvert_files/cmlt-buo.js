(function(){if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}})();window.ru.cmlt.utils.Package=(function(global){return{declare:function(namespace,constructor){var names=namespace.split("."),currentObject=global,name,newObject;for(var i=0,len=names.length;i<len;i++){name=names[i].trim();newObject=currentObject[name]||{};currentObject[name]=constructor&&i===len-1?constructor:newObject;currentObject=newObject;}return currentObject;}};})(window);(function(global,utils,$){utils.Package.declare("ru.cmlt.utils.Common",new Common());function Common(){}Common.prototype.checkSpecialsSymbols=function(input){var value=input.value,rep=/[<>&]/i;if(rep.test(value)){value=value.replace(rep,"");input.value=value;}};Common.prototype.htmlDecode=function(value){return value?$("<div/>").html(value).text():"";};Common.prototype.numberToPrice=function(str){if(!str){return"";}var formatted=str.replace(new RegExp(",","g"),".").replace(new RegExp(" ","g"),""),thousandsFormatted="",thousandsSeparator=" ",thousandsCount=0;var formattedArray=formatted.split("."),centsVal=formattedArray.length>1?formattedArray[1]:"",integerVal=formattedArray[0];if(thousandsSeparator){for(var i=integerVal.length;i>0;i--){var symbol=integerVal.substr(i-1,1);thousandsCount++;if(thousandsCount%3===0){symbol=thousandsSeparator+symbol;}thousandsFormatted=symbol+thousandsFormatted;}if(thousandsFormatted.substr(0,1)===thousandsSeparator){thousandsFormatted=thousandsFormatted.substring(1,thousandsFormatted.length);}var centsDelimiter=(formattedArray.length>1)||formatted.indexOf(".")!==-1?".":"";}return thousandsFormatted+centsDelimiter+centsVal;};Common.prototype.validateLength=function(object,maxLength,disabledId){var text_length_name="text-length_"+$(object).attr("id");$("#"+text_length_name).html("");var len=$(object).val().length;$("#"+text_length_name).html((maxLength-len));if(len<=maxLength){$("#"+text_length_name).addClass("normal_length");$("#"+text_length_name).removeClass("overlong");if(disabledId!="undefined"){enableButton(disabledId);}}else{$("#"+text_length_name).removeClass("normal_length");$("#"+text_length_name).addClass("overlong");if(disabledId!="undefined"){disableButton(disabledId);}}};Common.prototype.logEvent=function(info){$.post("/log-event",{message:("package: ${packageName}; function: ${functionName}; "+"name: ${name}; message: ${message}; stack: ${stack};").replace("${packageName}",info.packageName).replace("${functionName}",info.functionName).replace("${name}",info.exception.name).replace("${message}",info.exception.message).replace("${stack}",info.exception.stack)});};})(window,window.ru.cmlt.utils,window.jQuery);(function(global,utils,$){utils.Package.declare("ru.cmlt.utils.DateUtils",new DateUtils());function DateUtils(){this._defaultDateFormat="dd.mm.yy";}DateUtils.prototype.getDefaultDateFormat=function(){return this._defaultDateFormat;};DateUtils.prototype.parseDate=function(dateFormat,dateString){return $.datepicker.parseDate((dateFormat.indexOf("dd")!=-1?"":"dd ")+dateFormat,(dateFormat.indexOf("dd")!=-1?"":"01 ")+dateString);};DateUtils.prototype.formatDate=function(date,dateFormat){if(dateFormat==null||dateFormat==""){dateFormat=this._defaultDateFormat;}var dd=date.getDate();if(dd<10){dd="0"+dd;}var mm=date.getMonth()+1;if(mm<10){mm="0"+mm;}var yy=date.getFullYear();return dateFormat.replace("dd",dd).replace("mm",mm).replace("yy",yy);};DateUtils.prototype.getLastStartMouth=function(date){var mouth=date.getMonth();if(date.getDate()==1){mouth=mouth-1;}return new Date(date.getFullYear(),mouth,1);};DateUtils.prototype.getNextLastDateMouth=function(date){var year=date.getFullYear();var month=date.getMonth();var day=this.getLastDayMonth(year,month);if(date.getDate()===day){month=month+1;day=this.getLastDayMonth(year,month);}return new Date(year,month,day);};DateUtils.prototype.getLastDayMonth=function(year,month){if(month===1){return year%4||(!(year%100)&&year%400)?28:29;}return month===3||month===5||month===8||month===10?30:31;};})(window,window.ru.cmlt.utils,window.jQuery);(function(global,utils,$){utils.Package.declare("ru.cmlt.utils.ComponentUtils",new ComponentUtils());function ComponentUtils(){}ComponentUtils.prototype.addDatepicker=function(selector,dateFormat){if(dateFormat==null||dateFormat==""){dateFormat=utils.DateUtils.getDefaultDateFormat();}var calendarClass="ui-datepicker";if(dateFormat.indexOf("dd")!=-1){calendarClass=calendarClass+"-day";}if(dateFormat.indexOf("mm")!=-1){calendarClass=calendarClass+"-months";}if(dateFormat.indexOf("yy")!=-1){calendarClass=calendarClass+"-years";}selector.datepicker({dateFormat:dateFormat,changeMonth:true,changeYear:true,showButtonPanel:true,closeText:"Выбрать",beforeShow:function(){$("#ui-datepicker-div").addClass(calendarClass);var dateString=$(this).val();if(dateString.length>0){try{var defaultDate=utils.DateUtils.parseDate(dateFormat,dateString);$(this).datepicker("option","defaultDate",defaultDate);$(this).datepicker("setDate",defaultDate);}catch(error){}}}}).focus(function(){var datepicker=$("#ui-datepicker-div");var calendar=$(this);$(".ui-datepicker-close").unbind("click").click(function(){var month=datepicker.find(".ui-datepicker-month :selected").val();var year=datepicker.find(".ui-datepicker-year :selected").val();var day=datepicker.find(".ui-datepicker-day :selected").val();calendar.datepicker("setDate",new Date(year,month,day!=null?day:1));});});};})(window,window.ru.cmlt.utils,window.jQuery);(function(utils){utils.Package.declare("ru.cmlt.patterns.Page",{extend:function(newPage){newPage.prototype=new Page();}});function Page(){}Page.prototype.initialize=function(){typeof this._cacheElements==="function"&&this._cacheElements();typeof this._createWidgets==="function"&&this._createWidgets();typeof this._bindEvents==="function"&&this._bindEvents();typeof this._ready==="function"&&this._ready();};})(window.ru.cmlt.utils);(function(utils){utils.Package.declare("ru.cmlt.patterns.Widget",{extend:function(newWidget){newWidget.prototype=new Widget();}});function Widget(){}Widget.prototype.initialize=function(){typeof this._cacheElements==="function"&&this._cacheElements();typeof this._createWidgets==="function"&&this._createWidgets();typeof this._bindEvents==="function"&&this._bindEvents();typeof this._ready==="function"&&this._ready();};Widget.prototype.on=function(eventName,handler,context){if(!this._eventHandlers[eventName]){this._eventHandlers[eventName]=[];}this._eventHandlers[eventName].push({handler:handler,context:context});};Widget.prototype.off=function(eventName,handler){var handlers=this._eventHandlers[eventName];if(!handlers){return;}for(var i=0,len=handlers.length;i<len;i++){if(handlers[i].handler===handler){handlers.splice(i--,1);}}};Widget.prototype.trigger=function(eventName){var handlers=this._eventHandlers[eventName];if(!handlers){return;}for(var i=0,len=handlers.length;i<len;i++){handlers[i].handler.apply(handlers[i].context,[].slice.call(arguments,1));}};})(window.ru.cmlt.utils);