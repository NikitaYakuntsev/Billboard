!function(t){"function"==typeof define&&define.amd?define(t):window.purl=t()}(function(){function t(t,e){for(var o=decodeURI(t),a=h[e?"strict":"loose"].exec(o),n={attr:{},param:{},seg:{}},s=14;s--;)n.attr[f[s]]=a[s]||"";return n.param.query=i(n.attr.query),n.param.fragment=i(n.attr.fragment),n.seg.path=n.attr.path.replace(/^\/+|\/+$/g,"").split("/"),n.seg.fragment=n.attr.fragment.replace(/^\/+|\/+$/g,"").split("/"),n.attr.base=n.attr.host?(n.attr.protocol?n.attr.protocol+"://"+n.attr.host:n.attr.host)+(n.attr.port?":"+n.attr.port:""):"",n}function e(t){var e=t.tagName;return"undefined"!=typeof e?p[e.toLowerCase()]:e}function o(t,e){if(0===t[e].length)return t[e]={};var o={};for(var a in t[e])o[a]=t[e][a];return t[e]=o,o}function a(t,e,n,i){var s=t.shift();if(s){var r=e[n]=e[n]||[];"]"==s?c(r)?""!==i&&r.push(i):"object"==typeof r?r[d(r).length]=i:r=e[n]=[e[n],i]:~s.indexOf("]")?(s=s.substr(0,s.length-1),!g.test(s)&&c(r)&&(r=o(e,n)),a(t,r,s,i)):(!g.test(s)&&c(r)&&(r=o(e,n)),a(t,r,s,i))}else c(e[n])?e[n].push(i):e[n]="object"==typeof e[n]?i:"undefined"==typeof e[n]?i:[e[n],i]}function n(t,e,o){if(~e.indexOf("]")){var n=e.split("[");a(n,t,"base",o)}else{if(!g.test(e)&&c(t.base)){var i={};for(var r in t.base)i[r]=t.base[r];t.base=i}""!==e&&s(t.base,e,o)}return t}function i(t){return l(String(t).split(/&|;/),function(t,e){try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(o){}var a=e.indexOf("="),i=r(e),s=e.substr(0,i||a),l=e.substr(i||a,e.length);return l=l.substr(l.indexOf("=")+1,l.length),""===s&&(s=e,l=""),n(t,s,l)},{base:{}}).base}function s(t,e,o){var a=t[e];"undefined"==typeof a?t[e]=o:c(a)?a.push(o):t[e]=[a,o]}function r(t){for(var e,o,a=t.length,n=0;a>n;++n)if(o=t[n],"]"==o&&(e=!1),"["==o&&(e=!0),"="==o&&!e)return n}function l(t,e){for(var o=0,a=t.length>>0,n=arguments[2];a>o;)o in t&&(n=e.call(void 0,n,t[o],o,t)),++o;return n}function c(t){return"[object Array]"===Object.prototype.toString.call(t)}function d(t){var e=[];for(var o in t)t.hasOwnProperty(o)&&e.push(o);return e}function u(e,o){return 1===arguments.length&&e===!0&&(o=!0,e=void 0),o=o||!1,e=e||window.location.toString(),{data:t(e,o),attr:function(t){return t=m[t]||t,"undefined"!=typeof t?this.data.attr[t]:this.data.attr},param:function(t){return"undefined"!=typeof t?this.data.param.query[t]:this.data.param.query},fparam:function(t){return"undefined"!=typeof t?this.data.param.fragment[t]:this.data.param.fragment},segment:function(t){return"undefined"==typeof t?this.data.seg.path:(t=0>t?this.data.seg.path.length+t:t-1,this.data.seg.path[t])},fsegment:function(t){return"undefined"==typeof t?this.data.seg.fragment:(t=0>t?this.data.seg.fragment.length+t:t-1,this.data.seg.fragment[t])}}}var p={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href",embed:"src",object:"data"},f=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],m={anchor:"fragment"},h={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},g=/^[0-9]+$/;return u.jQuery=function(t){null!=t&&(t.fn.url=function(o){var a="";return this.length&&(a=t(this).attr(e(this[0]))||""),u(a,o)},t.url=u)},u.jQuery(window.jQuery),u}),$(function(){"use strict";var t=$("#map-url"),e=function(e){var o=e.data("current-val");e.on("change",function(){var e=$(this),o=e.val(),a=$('option[value="'+o+'"]',e),n=a.data("default"),i=$.url().param();n?delete i.s:i.s=o,delete i.p,t&&t.length&&(i.geo=t.data("coords")),window.location=$.url().attr("path")+($.param(i)?"?"+$.param(i):"")}),o&&e.val(o)};$.fn.searchSortOrder=function(t){return this.each(function(){var o=$(this),a=o.data("CatalogMap");a&&"string"==typeof t?"function"==typeof a[t]&&a[t]():o.data("SearchSortOrder",new e(o))})}}),$(function(){"use strict";function t(){o=$(".j-lazy"),a=$(".j-lazy-noscript"),a.removeClass("j-lazy-noscript").hide(),o.show(),s.off(".lazy").on("scroll.lazy resize.lazy",function(){n||(n=setTimeout(e,$.browser.msie?100:10))}),e()}function e(){var t,e=s.scrollTop()+s.height()+r;t=o.filter(function(){var t=$(this);return e>t.offset().top?(t.attr("src",t.data("srcpath")).removeClass("j-lazy"),!1):!0}),t.length?setTimeout(function(){t.addClass("photo-count-show")},300):(s.off(".lazy"),o.addClass("photo-count-show")),clearTimeout(n),n=!1}var o,a,n,i=$(document.body),s=$(window),r=300;i.off("reset.lazy").on("reset.lazy",t),t()}),$(function(){"use strict";var t=function(t){function e(){for(a=$("<div></div>").addClass("catalog_counts_cm").hide().insertAfter(i),n=$('<div class="catalog_counts_cm-inner"></div>').appendTo(a),c=l=Math.ceil(m.length/(t.data("counterColsFull")||$("ul",i).length)),u=0;u<m.length;++u,++c)d=m[u],c>=l&&(c=0,s&&s.appendTo(n),s=$("<ul></ul>")),r=$("<li></li>").appendTo(s),$("<a></a>").attr("href",d.url).text(d.name).appendTo(r),$("<span></span>").text(" "+(d.cnt+"").replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")).appendTo(r);$("li",s).length>0&&s.appendTo(n),s.addClass("catalog_counts_nm")}function o(){a||e(),i.toggle(),a.toggle(),p.toggleClass("catalog_counts-switch_on").toggleClass("pseudo-link")}var a,n,i,s,r,l,c,d,u,p=$(".catalog_counts-switch > span",t),f=t.data("counterIdx"),m=avito.counters[f]||{};p.length&&(i=$(".catalog_counts-cl:first",t),p.click(function(){$(this).hasClass("catalog_counts-switch_on")||o()}))};$.fn.catalogCountsIdx=function(e){return this.each(function(){var o=$(this),a=o.data("CatalogCountsIdx");a&&"string"==typeof e?"function"==typeof a[e]&&a[e]():o.data("CatalogCountsIdx",new t(o))})}}),avito.coords=avito.coords||{},avito.coords.precisionMap={10:1,11:1.5,12:2,13:2,14:2.5,15:3,16:3,17:3.5,18:3.5,19:4},function(){"use strict";$.simpleTemplate=function(t){return{render:function(e){var o,a,n=t;for(o in e)e.hasOwnProperty(o)&&(a=new RegExp("{{"+o+"}}","g"),n=n.replace(a,e[o]));return n.replace(/{{[^(}})]+}}/g,"")}}}}(),function(t){"use strict";var e,o="2.1";e=function(){var e,a;return function(n,i){return a?a:(e=t.Deferred(function(e){window.avito||(window.avito={}),window.avito.ymapsReady||(window.avito.ymapsReady=e.resolve),t.ajax({url:"//api-maps.yandex.ru/"+(i||o)+"/?load="+n+"&lang=ru-RU&onload=avito.ymapsReady",dataType:"script",cache:!0}).fail(e.reject)}),a=e.promise())}}(),t.yandexMap=function(a,n){var i={},s=Modernizr.svg?o:"2.0",r=t.map(n.packages,function(t){return["package",t].join(".")}).join(),l=e(r,s);return i.version=s,i.init=function(e){var o=t.Deferred();return l.done(function(){var n,s,r;for(a.empty(),e=t.extend(!0,{map:{type:"yandex#map",controls:[]},controls:[],behaviors:[{name:"scrollZoom",status:"disable"}],events:[]},e),e.controls.length||e.map.controls.length||(e.controls=["zoomControl","typeSelector"]),i.ymap=new ymaps.Map(a.get(0),e.map),s=0,r=e.controls.length;r>s;s++)void 0!==e.controls[s].name&&i.ymap.controls.add(e.controls[s].name,e.controls[s].params||{});for(s=0,r=e.behaviors.length;r>s;s++)if(void 0!==e.behaviors[s].name)switch(e.behaviors[s].status){case"enable":i.ymap.behaviors.enable(e.behaviors[s].name);break;case"disable":i.ymap.behaviors.disable(e.behaviors[s].name)}for(s=0,r=e.events.length;r>s;s++)void 0!==e.events[s].name&&"function"==typeof e.events[s].callback&&i.ymap.events.add(e.events[s].name,e.events[s].callback);e.placemark&&(ymaps.layout.storage.add("im#bLayout",ymaps.templateLayoutFactory.createClass('<div class="map-balloon b-tooltip b-tooltip-top visible"><div class="b-tooltip-arrow"></div><div class="balloon-content">{{ properties.balloonContent }}</div><i class="i-x-gray"></i></div>',{build:function(){var e=this.getParentElement();this.constructor.superclass.build.call(this),this.$balloon=t(".map-balloon",e),this.$arrow=t(".b-tooltip-arrow",this.$balloon),this.$balloonContent=t(".balloon-content",this.$balloon),this.$closeButton=t(".i-x-gray",e),this.$balloon.css({width:Math.min(this.$balloonContent.outerWidth(),a.outerWidth()-110)}),this.$balloon.css({left:-(this.$balloon.outerWidth()/2),top:-(this.$balloon.outerHeight()+this.$arrow.outerHeight())}),this.attachListeners()},clear:function(){this.$balloonContent.empty(),this.detachListeners(),this.constructor.superclass.clear.call(this)},attachListeners:function(){this.$closeButton.on("click",ymaps.util.bind(this.onCloseButtonClick,this))},detachListeners:function(){this.$closeButton.off("click")},onCloseButtonClick:function(){this.events.fire("userclose")},getClientBounds:function(){var t=this.$balloon.position();return[[t.left,t.top],[t.left+this.$balloon.outerWidth(),t.top+this.$balloon.outerHeight()+this.$arrow.outerHeight()]]}})),n=new ymaps.Placemark(i.ymap.getCenter(),{balloonContent:e.placemark.balloonContent},{iconContentOffset:[3,5],iconLayout:"default#image",iconShadow:!0,iconImageHref:"/s/a/i/sprites/item-map-marker-sprite.png",iconImageClipRect:[[0,0],[23,35]],iconImageSize:[23,35],iconImageOffset:[-13,-35],iconShadowImageHref:"/s/a/i/sprites/item-map-marker-sprite.png",iconShadowImageClipRect:[[0,37],[15,44]],iconShadowImageSize:[15,7],iconShadowImageOffset:[-8,-2],hideIconOnBalloonOpen:!1,balloonLayout:"im#bLayout",balloonShadow:!1,balloonOffset:[-1,5],balloonZIndex:780}),i.ymap.geoObjects.add(n),n.balloon.open()),o.resolve()}).fail(o.reject),o.promise()},i},t.fn.yandexMap=function(e){return new t.yandexMap(this,t.extend({packages:["standard"]},e))}}(jQuery),function(t){"use strict";var e=1e3,o={center:[55.756678,37.61804],zoom:15},a=10,n=15,i=avito&&avito.coords&&avito.coords.precisionMap||{10:1},s={mode:"default",searchFormSelector:"#search_form",regionFieldSelector:"#region",sortFieldSelector:".j-sort-select",expandBtnSelector:".expand",urlBtnContainerSelector:".url-btn-container",urlFieldSelector:"#map-url",amountInfoSelector:".amount-info",classes:{expanding:"expanding",expanded:"expanded",close:"close",fullScreen:"fullscreen",loading:"loading",hidden:"hidden",itemsFit:"items-fit",lock:"scroll-lock",mapDummy:"map-dummy",balloon:"map-balloon",balloonCloseButton:"i-x-gray",balloonContentHead:"balloon-content-head",balloonContentBody:"tooltip-content-body",cluster:"cluster",clusterContent:"cluster-content"},url:{geocode:"/js/coords/",coords:"/js/catalog/coords",items:"/js/catalog/items",catalog:"/js/catalog"},map:{balloonShadow:!1,balloonLayout:"cm#bLayout",balloonOffset:[0,5],balloonAutoPanMargin:110},clusterer:{maxZoom:n,gridSize:64,zoomMargin:30,clusterOpenBalloonOnClick:!0,clusterIcons:[{href:"/s/a/i/sprites/map-cluster-sprite.png",size:[40,40],offset:[-20,-20],clipRect:[[0,118],[40,158]]},{href:"/s/a/i/sprites/map-cluster-sprite.png",size:[52,52],offset:[-26,-26],clipRect:[[0,62],[52,114]]},{href:"/s/a/i/sprites/map-cluster-sprite.png",size:[58,58],offset:[-29,-29],clipRect:[[0,0],[58,58]]}],clusterNumbers:[10,100],clusterIconLayout:"cm#clLayout",clusterIconShape:{type:"Circle",coordinates:[0,0],radius:20}},icon:{url:"/s/a/i/sprites/search-map-marker-sprite.png",size:[23,34],shadowSize:[15,7],shadowOffset:2},currency:"руб."},r=function(t,e){var o={};return function(a){var n="function"==typeof e?e(a):a;return o[n]&&"rejected"!==o[n].state()||(o[n]=t(a)),o[n]}},l={visitedList:JSON.parse(window.sessionStorage.getItem("avito.map.visited")||"{}")||[],setStatus:function(e,o){var a;t.isArray(this.visitedList)||(this.visitedList=[]),a=t.inArray(e,this.visitedList),o&&-1===a?this.visitedList.push(e):o||-1===a||this.visitedList.splice(a,1),window.sessionStorage.setItem("avito.map.visited",JSON.stringify(this.visitedList))},getStatus:function(e){return-1!==t.inArray(e,this.visitedList)}},c=function(e){var o,a=function(a){var n,i,s,r,c,d=[],u={add:[],remove:[],rawTotal:0};for(s in o)o.hasOwnProperty(s)&&o[s].properties.set({iconFontClass:"",iconContent:"0",itemIds:[]});for(n in a)a.hasOwnProperty(n)&&(i=[a[n].lat,a[n].lon],s=i.join(","),d.push(s),o[s]?(r=o[s].properties.get("itemIds"),t.isArray(r)&&-1===t.inArray(n,r)&&o[s].properties.set({itemIds:r.concat(n),iconContent:r.length+1,iconFontClass:r.length>98?"small-font":""})):(c=l.getStatus(s),o[s]=new ymaps.Placemark(i,{iconFontClass:"",iconContent:"1",itemIds:[n],visited:c},t.extend({},e,c?{iconImageClipRect:[[e.iconImageSize[0]+4,0],[2*e.iconImageSize[0]+4,e.iconImageSize[1]]]}:{})),u.add.push(o[s])),u.rawTotal+=1);for(s in o)o.hasOwnProperty(s)&&-1===t.inArray(s,d)&&(u.remove.push(o[s]),delete o[s]);return u},n=function(){o={}};return e=t.extend({},e),n(),{refresh:function(t){return a(t)},reset:function(){n()}}},d=function(e){function o(t){for(var e=-1,o=a.length,n=[];++e<o;)a[e].name===t&&n.push(e);if(n.length)for(e=0,o=n.length;o>e;e++)a.splice(n[e]-e,1)}var a=e.serializeArray();return{add:function(t){o(t.name),a.push(t)},remove:function(t){o(t)},getParamString:function(){return t.param(a)},isChildCategory:function(){for(var t=-1,e=a.length,o=!1;++t<e;)/^params/.test(a[t].name)&&a[t].value&&(o=!0);return o}}},u=function(n,s){function u(){n.on("click",s.expandBtnSelector,function(){p(!0)}).on("click","."+s.classes.close,function(){se&&(f(!1),m(!1)),p(!1)}).on("click","."+s.classes.fullScreen,function(){f(),m()})}function p(t){t!==V&&(V=t,ie&&n.off("webkitTransitionEnd transitionend").removeClass(s.classes.expanding),t&&ie?(n.one("webkitTransitionEnd transitionend",function(){n.removeClass(s.classes.expanding).addClass(s.classes.expanded)}),n.addClass(s.classes.expanding)):n.toggleClass(s.classes.expanded,t),t?h():(v(),Q.ymap.balloon.close()))}function f(e,o){var a,i,r,l;e=void 0===e?!se:e,e!==se&&(se=e,a=t(".nav",H),i=t(".nav-content",a),r=t(".search-map-full",H),l=t("#search_filters"),e?(oe.addClass(s.classes.lock).on("keydown.full_map",function(t){27===t.keyCode&&(f(!1),m(!1))}),H.on("click.full_map",".overlay",function(){f(!1),m(!1)}),t.mediator.on("refresh_content.search_map",function(t,e){switch(e){case"beforeSend":a.addClass(s.classes.loading);break;case"always":a.removeClass(s.classes.loading);break;case"done":r.css({top:a.height()}),Q.ymap.container.fitToViewport()}}),i.empty().append(t(".b-catalog-breadcrumbs").clone()).append(t(".b-catalog-counts").clone()).on("click.full_map",".j-count-link, .breadcrumb-link, .filter",function(e){var o,a,n=t(this),i=n.data("param"),s=n.attr("href");s&&(e.preventDefault(),n.is(".breadcrumb-link")?n.nextAll(".breadcrumb-link").each(function(){i=t(this).data("param"),i&&l.find('[name="params['+i.id+']"]').find("option:first").prop("selected",!0).end().trigger("change"),D.remove("params["+i.id+"]")}):n.is(".filter")?(o=n.data("user")||"",t("#search_form").find('input[name="user"]').val(o),D.add({name:"user",value:o})):i&&(l.find('[name="params['+i.id+']"]').val(i.value).trigger("change"),D.add({name:"params["+i.id+"]",value:i.value})),window.history&&window.history.pushState&&(a=t.url().attr("base")+s,window.history.pushState("","",a)),Q.ymap.balloon.close(),h())}),P=t('<div class="'+s.classes.mapDummy+'"></div>').css({height:n.height()}).insertAfter(n),H.removeClass(s.classes.hidden),r.css({top:a.height()}).append(n),o&&o.noNavUpdate===!0||a.addClass(s.classes.loading)):(Q.ymap.balloon.close(),fe=!1,oe.removeClass(s.classes.lock).off("keydown.full_map"),H.off("click.full_map"),H.addClass(s.classes.hidden),i.empty().off("click.full_map"),t.mediator.off("search_map"),P.replaceWith(n)))}function m(t){t=void 0===t?se:t,t?Q.ymap.behaviors.enable("scrollZoom"):Q.ymap.behaviors.disable("scrollZoom"),Q.ymap.container.fitToViewport()}function h(e){var o,n,i,r,l;e=e||{},o=e.zoom||Math.round(Q.ymap.getZoom()),a>o?v():(n=e.bounds||Q.ymap.getBounds(),i=$(n),i+=","+Math.round(o),se&&(i+=",f"),"item"===s.mode?(r=s.url.coords,l=t.extend({},J,{geo:i})):(r=[s.url.coords,D.getParamString()].join("?"),l={geo:i}),te=t.getJSON(r,l).always(function(){te=null}).done(function(t){var e;t&&("item"===s.mode&&t.coords&&t.coords[q]&&(ge||(me=t.coords[q].lat,he=t.coords[q].lon),delete t.coords[q],t.count--),"item"!==s.mode||ge||(g(),ge=!0),e=K.refresh(t.coords),z({shown:e.rawTotal,total:t.count}),U.remove(e.remove).add(e.add))}),"item"!==s.mode&&(e.refreshContent!==!1&&I(i),e.updateUrl!==!1&&j(i)))}function g(){var t=new ymaps.Placemark([me,he],{itemIds:q},{iconContentOffset:[3,5],iconLayout:"default#image",iconImageHref:"/s/a/i/sprites/search-map-marker-sprite.png",iconImageClipRect:[[54,0],[69,23]],iconImageSize:[15,23],iconImageOffset:[-Math.ceil(7.5),-21],zIndex:651,hideIconOnBalloonOpen:!1,hasBalloon:!1});Q.ymap.geoObjects.add(t)}function v(){clearTimeout(Y),y(),"item"!==s.mode&&(I(null),j("")),K.reset(),U&&U.removeAll(),N.removeClass("visible")}function y(){te&&1===te.readyState&&te.abort(),ee&&1===ee.readyState&&ee.abort()}function b(t){var o,n,i;o=Math.round(t.get("oldZoom")),n=Math.round(t.get("newZoom")),i=t.get("newBounds"),n>=a?(clearTimeout(Y),Y=setTimeout(function(){var t=O(i,n),e=B(n);Math.round(o)===Math.round(n)&&T(t,ae.outerBoundsCoords,Math.pow(10,-(e+1)))||(y(),ae.outerBoundsCoords=t.slice(),h({bounds:i,zoom:n,refreshContent:se?0:1}))},e)):o>=a&&v()}function w(){var e,a,i,r,l=t.Deferred();return"item"===s.mode?(a=me,i=he,r=parseFloat(n.data("map-zoom"))):e=C(n.data("coords")),e?l.resolve({bounds:e}):a&&i&&r?l.resolve({center:[a,i],zoom:r}):S().done(function(e){e=e||{},l.resolve(t.extend({},o,e))}).fail(function(){l.resolve(o)}),l.promise()}function C(t){var e,o,a,n;return o=t.split(","),4===o.length&&(a=[o.shift(),o.shift()],n=[o.shift(),o.shift()],e=[a,n]),e}function $(t){return t=t||[],[].concat.apply([],t).toString()}function S(){var e=t.Deferred();return t.getJSON(s.url.geocode+Z,{}).done(function(t){e.resolve({center:[t.lat,t.lng],zoom:t.zoom})}).fail(e.reject),e.promise()}function k(){return ymaps.templateLayoutFactory.createClass('<div class="'+s.classes.cluster+'"><span class="'+s.classes.clusterContent+'"></span></div>',{build:function(){var e=this.getParentElement(),o=this.getData(),a=o.properties.get("geoObjects"),n=this.countItems(a),i=o.options.get("clusterIcons"),r=o.options.get("clusterNumbers"),l=0,c=r.length;for(this.constructor.superclass.build.call(this),this.$cluster=t("."+s.classes.cluster,e),this.$clusterContent=t("."+s.classes.clusterContent,this.$cluster),this.$clusterContent.text(n);c>l&&!(n<r[l]);l++);this.$cluster.css({"background-image":'url("'+i[l].href+'")',"background-position":-i[l].clipRect[0][0]+"px "+-i[l].clipRect[0][1]+"px",width:i[l].size[0],height:i[l].size[1],top:i[l].offset[1],left:i[l].offset[0],"line-height":i[l].size[1]+"px"})},clear:function(){this.$clusterContent.text("")},countItems:function(t){for(var e,o=0,a=0,n=t.length;n>a;a++)e=t[a].properties.get("itemIds")||[],o+=e.length;return o}})}function x(){return ymaps.templateLayoutFactory.createClass(re.render(s.classes),{build:function(){var e,o=this.getParentElement(),a=this.getData();fe=!0,this.constructor.superclass.build.call(this),this.$balloon=t("."+s.classes.balloon,o),this.$arrow=t(".b-tooltip-arrow",this.$balloon),this.$closeButton=t("."+s.classes.balloonCloseButton,o),this.$balloonHead=t("."+s.classes.balloonContentHead,o),this.$balloonBody=t("."+s.classes.balloonContentBody,o),this.$balloonBody.addClass(s.classes.loading),e=ye(a.itemIds).done(ymaps.util.bind(this.onItemsLoaded,this)).always(ymaps.util.bind(function(){this.$balloonBody.removeClass(s.classes.loading)},this)).fail(ymaps.util.bind(function(){this.$balloonBody.html(pe.render({itemText:1===a.itemIds.length?"объявление":"объявления"}))},this)),be.call(this,a.coords).done(ymaps.util.bind(function(t){this.$balloonHead.html(t).attr("title",t)},this)).fail(function(){e.done(ymaps.util.bind(function(t){var e;for(e in t)if(t.hasOwnProperty(e)&&t[e].ext){this.$balloonHead.html(t[e].ext.address).attr("title",t[e].ext.address);break}},this))}),this.attachListeners(),this.applyElementOffset()},clear:function(){this.$balloonHead.empty(),this.$balloonBody.empty(),this.detachListeners(),this.constructor.superclass.clear.call(this)},attachListeners:function(){this.$closeButton.on("click",ymaps.util.bind(this.onCloseButtonClick,this))},detachListeners:function(){this.$closeButton.off("click")},onCloseButtonClick:function(){this.events.fire("userclose")},onItemsLoaded:function(t){this.renderItems(t),this.applyElementOffset()},renderItems:function(t){var e,o,a,n,i="",r="",l={prodam:"продам",sdam:"сдам"};if(t){for(e in t)t.hasOwnProperty(e)&&(a=t[e].image_url?de.render({link:t[e].url,imgSrc:t[e].image_url}):"","item"!==s.mode&&D.isChildCategory()||(n=l[t[e].type],n&&(r=ue.render({type:t[e].type,text:n}))),i+=ce.render({link:t[e].url,title:t[e].title,price:M(t[e].price,t[e].currency,t[e].cparams&&t[e].cparams.is_longterm),image:a,type:r}));o=le.render({items:i}),this.$balloonBody.html(o)}},applyElementOffset:function(){this.$balloon.css({left:-Math.floor(this.$balloon[0].offsetWidth/2),top:-(this.$balloon[0].offsetHeight+this.$arrow[0].offsetHeight)})},getClientBounds:function(){var t=this.$balloon.position();return[[t.left,t.top],[t.left+this.$balloon[0].offsetWidth,t.top+this.$balloon[0].offsetHeight+this.$arrow[0].offsetHeight]]},getShape:function(){if(!this.$balloon.length)return MyBalloonLayout.superclass.getShape.call(this);var t=this.$balloon.position();return new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([[t.left,t.top],[t.left+this.$balloon[0].offsetWidth,t.top+this.$balloon[0].offsetHeight+this.$arrow[0].offsetHeight]]))}})}function I(e){e=e||"",t.mediator.trigger("refresh_content.search_map","beforeSend"),ee=t.getJSON([s.url.catalog,D.getParamString()].join("?"),{geo:e,s:ae.sorting}).always(function(){ee=null,t.mediator.trigger("refresh_content.search_map","always")}).done(function(e){var o;if(e){for(o in e)e.hasOwnProperty(o)&&t.mediator.trigger("catalog.init_block",[{name:o,html:e[o]}]);t.mediator.trigger("refresh_content.search_map","done")}}).fail(function(e,o){"error"===o&&t.mediator.trigger("catalog.clear_blocks")})}function j(e){var o,a=t.url().param();e=e||"",e?a.geo=e:delete a.geo,o=t.url().attr("path")+(t.param(a)?"?"+t.param(a):""),window.history&&window.history.replaceState?window.history.replaceState("","",o):A&&A.val(t.url().attr("base")+o).data("coords",e)}function z(t){t.total===t.shown?N.removeClass("visible"):N.find(".shown").text([t.shown,avito.i18n.plural(t.shown,["объявление","объявления","объявлений"])].join(" ")).end().find(".total").text(t.total).end().addClass("visible")}function _(){var e=R.find("button"),o=e.next(".b-tooltip");A=t(s.urlFieldSelector),A.val(window.location.href),oe.on("click",function(e){var a=t(e.target);a.closest(s.urlBtnContainerSelector).length||o.hide()}),e.on("click",function(){o.toggle(),A.get(0).select()}),A.on("keydown",function(t){27===t.keyCode&&o.hide()})}function O(e,o){return t.map(e,function(e,a){return[t.map(e,function(t){return L(t,B(o),a)})]})}function L(t,e,o){var a,n=Math.floor(e),i=n===e?1:Math.round(1/(e-n)),s=Math.pow(10,n)*i;return a=t>0&&!o||0>t&&o?"floor":"ceil",Math[a](t*s)/s}function B(t){var e,o,a=1/0;if(t=Math.round(t),!i[t]){for(e in i)i.hasOwnProperty(e)&&a>Math.abs(t-i[e])&&(a=Math.abs(t-i[e]),o=parseInt(e,10));t=o}return i[t]}function T(t,e,o){var a,n;for(t=[].concat.apply([],t),e=[].concat.apply([],e),a=0,n=t.length;n>a;a++)if(Math.abs(t[a]-e[a])>o)return!1;return!0}function M(t,e,o){var a="";return t>10&&(a=[formatNumber(t,0),e||s.currency].join(" "),void 0!==o&&(a+=o?" в месяц":" за сутки")),a}{var F,H,P,R,A,N,W,D,E,Z,q,J,Q,U,K,V,G,X,Y,te,ee,oe=t(document.body),ae={},ne=oe.hasClass("touch-device"),ie=!ne&&Modernizr.csstransitions,se=!1,re=t.simpleTemplate('<div class="{{balloon}} b-tooltip b-tooltip-top tooltip-heady visible"><div class="b-tooltip-arrow"></div><div class="balloon-content"><div class="tooltip-head"><div class="{{balloonContentHead}} fader"></div></div><div class="{{balloonContentBody}} has-loader"></div></div><i class="{{balloonCloseButton}}"></i></div>'),le=t.simpleTemplate('<ul class="list">{{items}}</ul>'),ce=t.simpleTemplate('<li class="item clearfix"><div class="item-image">{{image}}</div><div class="item-descr">{{type}}<span class="title fader"><a href="{{link}}" title="{{title}}" target="_blank">{{title}}</a></span><span class="price">{{price}}</span></div></li>'),de=t.simpleTemplate('<a class="image-link" href="{{link}}" target="_blank"><img src="{{imgSrc}}"></a>'),ue=t.simpleTemplate('<span class="type {{type}}">{{text}}</span>'),pe=t.simpleTemplate('<div class="balloon-error"><span class="c-8">Не удалось загрузить {{itemText}}</span></div>'),fe=!1,me=parseFloat(n.data("map-lat")),he=parseFloat(n.data("map-lon")),ge=!1,ve=n.data("show-neighbour")||!1,ye=r(function(e){return t.isArray(e)||(e=[e]),t.getJSON(s.url.items,{id:e})},function(e){return t.isArray(e)?e.sort(function(t,e){return t-e}).join():e}),be=r(function(e){var o=t.Deferred();return e?ymaps.geocode(e,{results:1}).then(function(t){var e=t.geoObjects.get(0),a=e.properties.get("name");o.resolve(a)},o.reject):o.reject(),o.promise()},function(t){return t&&t.join()});!function(){"function"==typeof t.fn.yandexMap&&(X=parseInt(n.data("limit"),10)||0,"item"===s.mode?(Z=n.data("location-id"),q=n.data("item-id"),J={location_id:Z,category_id:n.data("category-id"),shop:n.data("shop-id")},J=t.extend({},J,n.data("add-params"))):(W=t(s.searchFormSelector),D=d(W),D.remove("geo"),R=n.find(s.urlBtnContainerSelector),R&&R.length&&_(),E=t(s.regionFieldSelector),Z=E.val(),ae.sorting=t(s.sortFieldSelector).val()||"",s.hasFullScreen&&(H=t(".b-search-map-full",n).appendTo(oe))),F=t(".search-map",n),N=t(s.amountInfoSelector,n),V=n.hasClass(s.classes.expanded),G=Boolean(n.data("full")),Q=F.yandexMap({packages:["standard","clusters","geoObjects"]}),w().done(function(t){var e=[];e="item"===s.mode?[{name:"zoomControl"}]:[{name:"zoomControl",params:{size:"small",position:{top:7,left:7}}}],G&&s.hasFullScreen&&f(!0,{noNavUpdate:!0}),Q.init({map:t,controls:e,events:[{name:"boundschange",callback:function(t){fe||"item"===s.mode&&!ve?fe=!1:b(t)}}]}).done(function(){var t,e={};e.close="2.0"===Q.version?new ymaps.control.Button({data:{className:s.classes.close}},{layout:ymaps.templateLayoutFactory.createClass('<button class="map-btn $[data.className]" type="button"></button>')}):new ymaps.control.Button({data:{className:s.classes.close},options:{layout:ymaps.templateLayoutFactory.createClass('<button class="map-btn {{ data.className }}" type="button"></button>')}}),Q.ymap.controls.add(e.close,"2.0"===Q.version?{right:14,top:14}:{position:{right:14,top:14}}),"item"!==s.mode&&s.hasFullScreen&&"2.0"!==Q.version&&(e.fullscreen=new ymaps.control.Button({data:{},options:{layout:ymaps.templateLayoutFactory.createClass('<button class="btn map-btn '+s.classes.fullScreen+'" type="button">На весь экран</button>')}}),Q.ymap.controls.add(e.fullscreen,{position:{right:54,top:14}})),"item"!==s.mode&&u(),ymaps.layout.storage.add("cm#clLayout",k()).add("cm#pmContentLayout",ymaps.templateLayoutFactory.createClass("2.0"===Q.version?'<i class="i-placemark $[properties.iconFontClass]">$[properties.iconContent]</i>':'<i class="i-placemark {{ properties.iconFontClass }}">{{ properties.iconContent }}</i>')).add("cm#bLayout",x()),K=c({iconContentLayout:"cm#pmContentLayout",iconContentOffset:[3,5],iconShadow:!0,iconLayout:"default#imageWithContent",iconImageHref:s.icon.url,iconImageClipRect:[[0,0],s.icon.size],iconImageSize:s.icon.size,iconImageOffset:[-Math.ceil(s.icon.size[0]/2),-s.icon.size[1]],iconShadowImageHref:s.icon.url,iconShadowImageClipRect:[[0,s.icon.size[1]+s.icon.shadowOffset],[s.icon.shadowSize[0],s.icon.size[1]+s.icon.shadowOffset+s.icon.shadowSize[1]]],iconShadowImageSize:s.icon.shadowSize,iconShadowImageOffset:[-Math.ceil(s.icon.shadowSize[0]/2),-2],hideIconOnBalloonOpen:!1,hasBalloon:!1,balloonPanelMaxMapArea:0}),Q.ymap.options.set(s.map),U=new ymaps.Clusterer(s.clusterer),U.events.add("click",function(t){var e,o,a=t.get("target"),n=U.getObjectState(a);n.isShown&&(e=a.geometry.getCoordinates(),o=a.properties.get("itemIds"),Q.ymap.balloon.open(e,{itemIds:o,coords:e}),a.properties.get("visited")||(a.options.set({iconImageClipRect:[[s.icon.size[0]+4,0],[2*s.icon.size[0]+4,s.icon.size[1]]]}),a.properties.set({visited:!0}),l.setStatus(e.join(),!0)))}),Q.ymap.geoObjects.add(U),t=Q.ymap.getBounds(),ae.outerBoundsCoords=O(t,Q.ymap.getZoom()),G&&s.hasFullScreen&&m(!0),V&&("item"!==s.mode||ve?h({bounds:t,refreshContent:!1}):g())})}))}()}};t.fn.searchMap=function(e){return this.each(function(){var o=t(this),a=o.data("SearchMap");a?"string"==typeof e&&a[e]&&a[e]():(("object"==typeof e||void 0===e)&&(e=t.extend(!0,{},s,e)),o.data("SearchMap",new u(o,e)))})}}(jQuery),$(function(){"use strict";function t(t,a){var n=t.count.items+t.count.shops;e.html(n),o.toggleClass("header__favorites_empty",0===n),a(t)}var e=$(".j-favorites-count"),o=$(".j-favorites-count__wrap"),a={item:"/favorites/",shop:"/favorites/shops/"};avito.favorites={add:function(e,o,n){$.ajax({url:a[e]+"add/"+o,success:function(e){t(e,n)}})},remove:function(e,o,n){$.isArray(o)||(o=[{name:"fav[]",value:o}]),$.post(a[e]+"del/",o).success(function(e){t(e,n)})}}}),$(function(){$(document).keydown(function(t){if(t.ctrlKey||t.altKey){var e;switch(t.keyCode?t.keyCode:t.which?t.which:null){case 37:e=$("#PrevLink");break;case 39:e=$("#NextLink")}e&&e.length>0&&(window.location=e.attr("href"))}})}),$(function(){"use strict";function t(){var t=$(".ad_vr");0===t.length&&o.off(e),t.filter(":in-viewport").each(function(){var t=this.id;$(this).removeClass("ad_vr"),adsRequestCounter(window.dfpSlots[t],"r"),googletag.cmd.push(function(){googletag.display(t)})})}var e="scroll.dfp_check",o=$(window);o.on(e,$.throttle(t,500))}),function(t){"use strict";var e={stickyBorder:"top",fixWidth:!0,offset:0,upperLimit:0,lowerLimit:1/0,onToggleFixed:t.noop},o=function(e,o){function a(){s.on("scroll.sticky",function(){i||(i=setTimeout(n,t.browser.msie?250:25))}).on("keyup.sticky",function(t){(35===t.keyCode||36===t.keyCode)&&n()}).on("sticky.update",n)}function n(){var t,a=r.scrollTop(),n=e.height(),c=e.offset().top,d="function"==typeof o.lowerLimit&&o.lowerLimit()||o.lowerLimit,u="function"==typeof o.upperLimit&&o.upperLimit()||o.upperLimit,p=e.css("position");if(n>10){if("absolute"!==p&&d<=c+n+o.offset&&a>=c)return s.off(".sticky"),clearTimeout(i),void(i=0);"top"===o.stickyBorder?"fixed"===p?a>=d-n-o.offset?(e.css({position:"absolute",top:d-n+"px"}),o.onToggleFixed(!1)):a<u-o.offset&&(e.css({position:l,width:""}),o.onToggleFixed(!1)):("absolute"!==p&&a>=u-o.offset||"absolute"===p&&a<d-n-o.offset)&&(e.css({position:"fixed",width:o.fixWidth?e.width():"",top:o.offset+"px"}),o.onToggleFixed(!0)):"bottom"===o.stickyBorder&&(t=s.height(),"fixed"===p?a+t<u+n+o.offset?(e.css({position:"absolute",top:u+"px"}),o.onToggleFixed(!1)):a+t>=d-o.offset&&(e.css({position:l,width:""}),o.onToggleFixed(!1)):("absolute"!==p&&a+t<d-o.offset||"absolute"===p&&a+t>=u+n+o.offset)&&(e.css({position:"fixed",width:o.fixWidth?e.width():"",bottom:o.offset+"px"}),o.onToggleFixed(!0)))}clearTimeout(i),i=0}{var i,s=t(window),r=t(document),l=e.css("position");!function(){a(),i||n()}()}};t.fn.sticky=function(a){return this.each(function(){var n=t(this),i=n.data("Sticky");i?"string"==typeof a&&i[a]&&i[a]():(("object"==typeof a||void 0===a)&&(a=t.extend({},e,a)),n.data("Sticky",new o(n,a)))})}}(jQuery),$(document).ready(function(){"use strict";var t,e=$(".js-catalog-counts-certified-input"),o=!1,a={add:{href:"/favorites/add/",title:"Добавить в избранное"},del:{href:"/favorites/del/",title:"В избранном"}};!function(){var t=$(document.body),e={breadcrumbs:{selector:".b-catalog-breadcrumbs",init:function(){var t=$(".j-sort-select");t&&t.length&&t.searchSortOrder()}},catalog_before_ads:{parentSelector:".j-catalog_before-ads",init:function(){t.trigger("reset.lazy")}},catalog_after_ads:{parentSelector:".j-catalog_after-ads",init:function(){t.trigger("reset.lazy")}},counts:{selector:".b-catalog-counts",init:function(){var t=$(this.selector).find(".catalog_counts[data-counter-idx]");t&&t.length&&t.catalogCountsIdx()
}},vips:{parentSelector:".j-catalog-vips-container",selector:".b-vips"},pager:{selector:".j-pages"}};$.mediator.on("catalog.init_block",function(t,o){var a,n,i,s;if(o&&(a=e[o.name],n=$.trim(o.html||""),a)){if(a.parentSelector)i=$(a.parentSelector),s="html";else if(a.selector){if(!n)return;i=$(a.selector),s="replaceWith"}a.replace&&a.replace.apply(a),i[s](n),a.init&&a.init.apply(a)}}).on("catalog.clear_blocks",function(){var t;for(t in e)e.hasOwnProperty(t)&&(e[t].replace&&e[t].replace.apply(e[t]),e[t].parentSelector?$(e[t].parentSelector).empty():e[t].selector&&$(e[t].selector).empty())}),$.each(e,function(t,e){e.init&&e.init.apply(e)})}(),"function"==typeof $.fn.catalogCountsIdx&&$(".catalog_counts[data-counter-idx]").catalogCountsIdx(),"function"==typeof $.fn.searchMap&&$(".b-search-map").searchMap({hasFullScreen:!0}),"function"==typeof $.fn.sticky&&(t=$(".j-sticky"),t.sticky({offset:10,upperLimit:function(){for(var e=t.prevAll(":visible:first");!e||!e.length;)e=t.parent().prevAll(":visible:first");return e.offset().top+e.outerHeight()},lowerLimit:function(){return $(".j-pages").offset().top}})),e.length&&e.on("change",function(){var t=e.prop("checked");return o?void e.prop("checked",!t):(o=!0,e.parent().attr("data-state",t?"active":""),$("<img>",{src:e.data("tracker")}),void setTimeout(function(){$("#cert").val(t||"").closest("form").submit(),o=!1},250))}),$(".catalog-list").on("click",".j-favorite-toggle",function(t){var e=$(this),o=e.find(".i"),n=e.closest(".item").attr("id").substr(1),i=e.data("in-favorites");i?avito.favorites.remove("item",n,function(){o.addClass("i-favorites-big_empty"),e.attr("href",a.add.href+n).attr("title",a.add.title).data("in-favorites",!1)}):avito.favorites.add("item",n,function(){o.removeClass("i-favorites-big_empty"),e.attr("href",a.del.href+n).attr("title",a.del.title).data("in-favorites",!0)}),t.preventDefault()})});